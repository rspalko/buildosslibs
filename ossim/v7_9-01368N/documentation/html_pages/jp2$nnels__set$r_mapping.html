<HTML>
<HEAD>
<TITLE> Kakadu Hyper-Doc (jp2_channels::set_colour_mapping) </TITLE>
<STYLE TYPE="text/css">
<!--
.indented-text { padding-left: 20pt; }
.function-text { padding-left: 80pt;
                 text-indent: -60pt; }
-->
</STYLE>
</HEAD>
<BODY TEXT="#000000" LINK="#0000ff" BGCOLOR="#B4DCB4">
<P ALIGN="RIGHT">|<A HREF="#SynopsiS"> synopsis </A>||<A HREF="#ReturnS"> return value </A>||<A HREF="#ArgS"> arguments </A>||<A HREF="jp2$nnels__init.html"> prev </A>||<A HREF="jp2$nnels__set$y_mapping.html"> next </A>|</P>
<H1><A NAME="ToP">jp2_channels::set_colour_mapping</A></H1>
<DIR><DIR><H3><EM><U>Java:</U> Jp2_channels.Set_colour_mapping</EM></H3></DIR></DIR>
<P CLASS="function-text"><B>bool</B> set_colour_mapping(
<B>int</B>&nbsp;colour_idx,
<B>int</B>&nbsp;codestream_component,
<B>int</B>&nbsp;lut_idx=-1,
<B>int</B>&nbsp;codestream_idx=0,
<B>int</B>&nbsp;data_format=JP2_CHANNEL_FORMAT_DEFAULT,
const&nbsp;<B>int</B>&nbsp;*&nbsp;format_params=NULL)</P>
<DIR><DIR><P CLASS="function-text"><EM><U>Java:</U> public native boolean Set_colour_mapping(
int&nbsp;colour_idx,
int&nbsp;codestream_component,
int&nbsp;lut_idx,
int&nbsp;codestream_idx,
int&nbsp;data_format,
int[]&nbsp;format_params)</EM></P></DIR></DIR>
<P><A HREF="jp2$nnels.html">Go to class description.</A></P>

<P ALIGN="CENTER"><HR></P><H2><A NAME="SynopsiS">Synopsis</A></H2>
<DIV CLASS="indented-text">
<P>
This function is used, together with 
<A HREF="jp2$nnels__set$y_mapping.html">set_opacity_mapping</A> and 
<A HREF="jp2$nnels__set$t_mapping.html">set_premult_mapping</A>, to establish the relationship, if any, between code-stream
image components and the reproduction functions of
colour intensity, opacity and pre-multiplied opacity.
The present function is most important, establishing
the source of colour intensity information.
</P><P>
 Each colour's intensity may be directly assigned to
some code-stream image component. Alternatively, it
may be associated with the output of a palette lookup
table (LUT), together with a code-stream image component
which provides indices into the LUT.
</P><P>
 The 
<A HREF="jp2$nnels__set$r_mapping.html#data_format">data_format</A> argument identifies how the values recovered from
the output of a palette lookup table or directly from
the code-stream image component should be used to deduce
the colour's intensity values. The default approach
is to use the output integers from the palette or image
component directly. The most important alternative
is to re-interpret the integer values recovered from
the palette or codestream image component as floating
point values. These options are explained further below,
along with the 
<B>data_params</B> array that is needed if 
<A HREF="jp2$nnels__set$r_mapping.html#data_format">data_format</A> is anything other than 
<A HREF="globals.html#JP2_CHANNEL_FORMAT_DEFAULT">JP2_CHANNEL_FORMAT_DEFAULT</A>.
</P><P>
 The 
<A HREF="jp2$nnels__set$r_mapping.html#colour_idx">colour_idx</A> argument identifies the particular intensity channel
whose mapping is being defined. A complete 
<A HREF="jp2$nnels.html">jp2_channels</A> object must have an intensity mapping for each colour
channel. However, the 
<A HREF="jp2$nnels__init.html">init</A> function automatically installs a default mapping
which directly associates the first 
<B>num_colours</B> code-stream components of code-stream 0 with the 
<B>num_colours</B> intensity channels. If this is what you want, there
is no need to explicitly call the present function.
</P>
</DIV>

<P ALIGN="CENTER"><HR></P><H2><A NAME="ReturnS">Return Value</A></H2><DIV CLASS="indented-text">
<P>
True unless the arguments are invalid.
</P>
</DIV>
<H2><A NAME="ArgS">Arguments</A></H2><DIV CLASS="indented-text">
<H4><A NAME="colour_idx">colour_idx</A> [<B>int</B>]</H4><DIV CLASS="indented-text">
<P>
The meaning of this argument depends upon the colour
space. Some common examples are:
</P><UL><LI>
For monochrome (greyscale) imagery, the only legal
value is 0.
</LI><LI>
For RGB spaces, a colour index of 0 means red, 1 means
green and 2 mean blue.
</LI><LI>
For CMYK, 0 means cyan, 1 means magenta, 2 means yellow
and 3 means black.
</LI></UL><P>
 If the 
<A HREF="jp2$nnels__set$r_mapping.html#colour_idx">colour_idx</A> does not refer to a valid colour, based on the initialized
state of the interface, the function returns false.
</P>
</DIV>
<H4><A NAME="codestream_component">codestream_component</A> [<B>int</B>]</H4><DIV CLASS="indented-text">
<P>
Identifies the image component (starting from 0) of
the code-stream identified by 
<A HREF="jp2$nnels__set$r_mapping.html#codestream_idx">codestream_idx</A> which is used to create the relevant colour intensity
channel, either by direct assignment or after mapping
through a palette LUT.
</P>
</DIV>
<H4><A NAME="lut_idx">lut_idx</A> [<B>int</B>]</H4><DIV CLASS="indented-text">
<P>
Set to -1 (the default) if the code-stream image component
is to be assigned directly to the relevant colour intensity
channel. Otherwise, the code-stream component samples
are indices to a lookup table, where 
<A HREF="jp2$nnels__set$r_mapping.html#lut_idx">lut_idx</A> gives the index of the lookup table (starting from
0), as it appears in the 
<A HREF="jp2$lette.html">jp2_palette</A> object.
</P>
</DIV>
<H4><A NAME="codestream_idx">codestream_idx</A> [<B>int</B>]</H4><DIV CLASS="indented-text">
<P>
Index of the code-stream whose components and palette
lookup tables (if required) are used to generate this
colour intensity channel. The meaning of the index
for various file formats is as follows:
</P><UL><LI>
For JP2 files, there is only one code-stream which
can be interpreted by the file reader and it must have
index 0.
</LI><LI>
For JPX files, index 0 refers to the first code-stream
(first contiguous code-stream or fragment table) and
the first code-stream header box (if any) in the file.
Subsequent code-stream / code-stream header box pairs
are identified by consecutive integers. Note that the
same code-stream may be used to define intensity channels
in different JPX compositing layers.
</LI><LI>
For MJ2 files, all code-streams must have the same
reproduction rules and the index used here must be
0.
</LI></UL>
</DIV>
<H4><A NAME="data_format">data_format</A> [<B>int</B>]</H4><DIV CLASS="indented-text">
<P>
This argument should be zero unless the component or
palette data has an advanced interpretation. Non-zero
values are acceptable only when writing JPX files that
are not JP2-compatible. Specifically, accepted values
are as follows:
</P><UL><LI>
<A HREF="globals.html#JP2_CHANNEL_FORMAT_DEFAULT">JP2_CHANNEL_FORMAT_DEFAULT</A> = 0 means that the integer sample values recovered
from the codestream, or those recovered from a palette
(if 
<A HREF="jp2$nnels__set$r_mapping.html#lut_idx">lut_idx</A> &gt;= 0), are to be used directly. In JPEG2000, the
sample values recovered from a palette or codestream
are always conceptually integers, whose bit-depth and
signed/unsigned attributes are revealed by 
<A HREF="jp2$lette.html">jp2_palette</A> and 
<A HREF="jp2$sions.html">jp2_dimensions</A>, respectively, even though internal computation with
Kakadu might use a fixed-point or foating point numerical
data representation when processing data that has not
been reversibly compressed &mdash; such representations
can always be converted back to the integers that they
represent if necessary. The default interpretation
for these integers associates the maximum integer value
(signed or unsigned, as appropriate) with the maximum
intensity of the colour channel.
</LI><LI>
<A HREF="globals.html#JP2_CHANNEL_FORMAT_FIXPOINT">JP2_CHANNEL_FORMAT_FIXPOINT</A> means that the integer sample values recovered from
the codestream or palette, having bit-depth P, are
interpreted as fixed-point numbers (signed or unsigned,
as appropriate) with F fraction bits and I=P-F integer
bits, where I is the value supplied via the first entry
of the 
<A HREF="jp2$nnels__set$r_mapping.html#format_params">format_params</A> array. The real-valued fixed-point value is obtained
by dividing the B-bit integer value by 2^F, in the
usual way, whereupon the maximum intensity of the colour
channel is associated with the real value 1.0. The
reason for exchanging the number of integer bits I
as the format parameter, rather than the number of
fraction bits F, is that I can be used to correctly
interpret decoded sample values from the codestream
even if they have a relative representation that does
not technically depend upon the original precision
P. It is helpful to consider the difference between
the default interpretation of an unsigned integer and
the fixed-point interpretation when I=0. In the former
case, the maximum colour channel intensity maps to
the integer value 2^P-1, while in the latter case it
maps to 2^P, which is not quite attainable.
</LI><LI>
<A HREF="globals.html#JP2_CHANNEL_FORMAT_FLOAT">JP2_CHANNEL_FORMAT_FLOAT</A> means that the P-bit integer samples recovered from
the codestream or palette are to be re-interpreted
as floating point values with E exponent bits and M=P-1-E
mantissa bits, where the value of E is supplied by
the first entry of the 
<A HREF="jp2$nnels__set$r_mapping.html#format_params">format_params</A> array. The most significant integer bit is the floating
point sign flag, followed by the E exponent bits and
then the M mantissa bits. The signed exponent has been
offset by 2^{E-1}-1 to ensure an unsigned E-bit exponent
field. If all E bits of the exponent field are 0, the
mantissa is denormalized (no implicit leading 1), while
if all exponent bits are 1, the floating point value
is either +/- infinity (if the mantissa is 0) or else
an NaN. In practice, implementations should avoid using
exponents with all 1's. These definitions intentionally
agree exactly with those used by standard IEEE floating
point formats. IEEE single precision floats have E=8
and M=23; half-floats have E=5 and M=10; however there
is no need to be limited to these options. The maximum
colour intensity value is mapped to a floating point
value of 1.0 in this format. Note carefully that original
integers that are identified via 
<A HREF="jp2$sions.html">jp2_dimensions</A> or 
<A HREF="jp2$lette.html">jp2_palette</A> as unsigned still have their most significant bit
associated with the floating-point sign flag, but it
should be set to 0 by writers and readers should clip
decompressed data so that this bit does not become
non-zero. Note also that where an image component has
the 
<A HREF="globals.html#JP2_CHANNEL_FORMAT_FLOAT">JP2_CHANNEL_FORMAT_FLOAT</A> interpretation, an associated non-linear point transform
(NLT) should be defined in its codestream, for which
the 
<A HREF="globals.html#NLType">NLType</A> coding parameter attribute should be 
<A HREF="globals.html#NLType_UMAG">NLType_UMAG</A> (if the component is unsigned) or 
<A HREF="globals.html#NLType_SMAG">NLType_SMAG</A> (if the component is signed) &mdash; these both translate
ultimately to the same (SMAG) type code within codestream
NLT marker segments, indicating that negative integers
should be subjected to a sign-magnitude to two's-complement
conversion in order to guarantee contiguity of the
underlying quantizer voronoi cells &mdash; without
this, compression will be inefficient and quantization
errors can be massively amplified by the rendering
process.
</LI><LI>
<A HREF="globals.html#JP2_CHANNEL_FORMAT_SPLIT_EXP">JP2_CHANNEL_FORMAT_SPLIT_EXP</A> is a more exotic option that is primarily intended
for representing high dynamic range imagery with an
RGBE (RGB+exponent) format. In this format, two separate
integers are required to recover colour intensity values.
The primary integer X is derived from the image component
or palette identified via the 
<A HREF="jp2$nnels__set$r_mapping.html#codestream_component">codestream_component</A>, 
<A HREF="jp2$nnels__set$r_mapping.html#lut_idx">lut_idx</A> and 
<A HREF="jp2$nnels__set$r_mapping.html#codestream_idx">codestream_idx</A> arguments. The second integer is an exponent E that
is derived from a (usually different) image component
or palette lookup table that are identified via the
first three entries of the 
<A HREF="jp2$nnels__set$r_mapping.html#format_params">format_params</A> array: the first entry holds the exponent's codestream
component index; the second holds the exponent's lookup
table index (-1 if no palette is involved); the third
holds the exponent's codestream index (usually, but
not necessarily the same as 
<A HREF="jp2$nnels__set$r_mapping.html#codestream_idx">codestream_idx</A>). The real-value that is jointly represented by the
X and E integers is X * 2^{E-136} and a real-value
of 1.0 maps to the nominal maximum colour intensity
for the channel. Note that E may be a signed or an
unsigned integer.
</LI></UL>
</DIV>
<H4><A NAME="format_params">format_params</A> [const&nbsp;<B>int</B>&nbsp;*]</H4><DIV CLASS="indented-text">
<P>
This argument is ignored unless 
<A HREF="jp2$nnels__set$r_mapping.html#data_format">data_format</A> is one of 
<A HREF="globals.html#JP2_CHANNEL_FORMAT_FIXPOINT">JP2_CHANNEL_FORMAT_FIXPOINT</A>, 
<A HREF="globals.html#JP2_CHANNEL_FORMAT_FLOAT">JP2_CHANNEL_FORMAT_FLOAT</A> or 
<A HREF="globals.html#JP2_CHANNEL_FORMAT_SPLIT_EXP">JP2_CHANNEL_FORMAT_SPLIT_EXP</A>. In the first two cases, only the first entry of the
<A HREF="jp2$nnels__set$r_mapping.html#format_params">format_params</A> array is read. In the last case, three entries of
the 
<A HREF="jp2$nnels__set$r_mapping.html#format_params">format_params</A> array are read. In each case, 
<A HREF="jp2$nnels__set$r_mapping.html#format_params">format_params</A> may not be NULL and the interpretation of the parameter
values is provided with the description of the 
<A HREF="jp2$nnels__set$r_mapping.html#data_format">data_format</A> argument.
</P>
</DIV>
</DIV>

<P ALIGN="CENTER"><HR></P><P ALIGN="RIGHT">|<A HREF="#ToP"> top </A>||<A HREF="#SynopsiS"> synopsis </A>||<A HREF="#ReturnS"> return value </A>||<A HREF="#ArgS"> arguments </A>||<A HREF="jp2$nnels__init.html"> prev </A>||<A HREF="jp2$nnels__set$y_mapping.html"> next </A>|</P>
</BODY>
</HTML>
