<HTML>
<HEAD>
<TITLE> Kakadu Hyper-Doc (kdu_client::open_with_cache_file) </TITLE>
<STYLE TYPE="text/css">
<!--
.indented-text { padding-left: 20pt; }
.function-text { padding-left: 80pt;
                 text-indent: -60pt; }
-->
</STYLE>
</HEAD>
<BODY TEXT="#000000" LINK="#0000ff" BGCOLOR="#B4DCB4">
<P ALIGN="RIGHT">|<A HREF="#SynopsiS"> synopsis </A>||<A HREF="#ReturnS"> return value </A>||<A HREF="#ArgS"> arguments </A>||<A HREF="kdu_client__connect.html"> prev </A>||<A HREF="kdu_client__set$handling.html"> next </A>|</P>
<H1><A NAME="ToP">kdu_client::open_with_cache_file</A></H1>
<DIR><DIR><H3><EM><U>Java:</U> Kdu_client.Open_with_cache_file</EM></H3></DIR></DIR>
<P CLASS="function-text">virtual <B>int</B> open_with_cache_file(
<B>const char *</B>&nbsp;filename,
<B>const char *</B>&nbsp;cache_dir,
<B>int</B>&nbsp;cache_file_handling=KDU_CLIENT_FILE_LOAD_SAVE,
<B>bool</B>&nbsp;preamble_only=false)</P>
<DIR><DIR><P CLASS="function-text"><EM><U>Java:</U> public native int Open_with_cache_file(
String&nbsp;filename,
String&nbsp;cache_dir,
int&nbsp;cache_file_handling,
boolean&nbsp;preamble_only)</EM></P></DIR></DIR>
<P><A HREF="kdu_client.html">Go to class description.</A></P>

<P ALIGN="CENTER"><HR></P><H2><A NAME="SynopsiS">Synopsis</A></H2>
<DIV CLASS="indented-text">
<P>
This function may be used instead of 
<A HREF="kdu_client__connect.html">connect</A>, where content retrieved previously has been stored
in a cache file with the supplied 
<A HREF="kdu_client__ope$che_file.html#filename">filename</A>. If the function succeeds, it returns the initial
queue-id, which is invariably 0, although the 
<A HREF="kdu_client__is_alive.html">is_alive</A> function will immediately return true, as if the caller
had connected to the original source and then invoked
<A HREF="kdu_client__disconnect.html">disconnect</A> some time later.
</P><P>
 Like 
<A HREF="kdu_client__connect.html">connect</A>, this function implicitly invokes 
<A HREF="kdu_client__close.html">close</A>, destroying any pre-existing state. After a successful
return, it is possible to use the cache contents in
exactly the same manner as if 
<A HREF="kdu_client__connect.html">connect</A> had been called and at least one reply had been received.
In particular, 
<A HREF="kdu_client__is_active.html">is_active</A> and 
<A HREF="kdu_client__tar$_started.html">target_started</A> return true immediately and functions like 
<A HREF="kdu_client__get$get_name.html">get_target_name</A> can be used to retrieve the name of the logical target
that was found in the cache file.
</P><P>
 As with 
<A HREF="kdu_client__connect.html">connect</A>, the optional 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> argument to this function may be used to identify
a directory where cached JPIP content is expected to
be stored by an application. This serves two purposes:
</P><UL><LI>
If the client is configured to save cache contents
before closing, the information supplied via 
<A HREF="kdu_client__ope$che_file.html#filename">filename</A> will be stored to a consistently named cache file
within the 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> where it can be picked up and re-used by future JPIP
browsing sessions initiated either by 
<A HREF="kdu_client__connect.html">connect</A> or 
<A HREF="kdu_client__ope$che_file.html">open_with_cache_file</A>.
</LI><LI>
After opening and reading the contents of the supplied
<A HREF="kdu_client__ope$che_file.html#filename">filename</A>, the object also checks for any other cache file that
may exist within 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A>, following a consistent naming convention, that identifies
the same target and target-id (supposedly unique).
If such a file is found, its contents may be merged
with those read from 
<A HREF="kdu_client__ope$che_file.html#filename">filename</A>.
</LI></UL><P>
 Together, the above features allow the information
from multiple cache files that all describe the same
underlying JPIP target to be progressively merged together,
so that 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> always holds a file which represents the most complete
representation available. Moreover, that representation
can always be augmented by connecting to a JPIP server
and requesting additional content.
</P><P>
 Perhaps of greatest interest is the fact that the
<A HREF="kdu_client__reconnect.html">reconnect</A> function can be used to re-establish a live connection
with the original server recorded within the cache
file, exactly as if a call to 
<A HREF="kdu_client__connect.html">connect</A> had been followed by 
<A HREF="kdu_client__disconnect.html">disconnect</A>. The results from any such re-connection will also
be saved to the 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> if one is provided.
</P><P>
 This function provides a number of features to accelerate
the cache file loading process and make the system
as responsive as possible:
</P><UL><LI>
If the cache file identified by 
<A HREF="kdu_client__ope$che_file.html#filename">filename</A> contains a preamble (a set of high priority data-bins
that are specially identified), the function only loads
this preamble before returning. It launches a separate
thread to manage the rest of the loading process in
the background. This separate thread will post notifications
to any installed 
<A HREF="kdu$ifier.html">kdu_client_notifier</A> object, to indicate progress and completion of the
loading process, exactly as if there were a live server
connection. To understand how preambles are defined,
review the documentation for 
<A HREF="kdu_client__set$e_window.html">set_preserve_window</A>.
</LI><LI>
Regardless of whether the file contains a preamble
or not, if there is another compatible cache file,
in the directory identified by 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A>, and 
<A HREF="kdu_client__ope$che_file.html#cache_file_handling">cache_file_handling</A> includes the 
<A HREF="globals.html#KDU_CLIENT_FILE_LOAD">KDU_CLIENT_FILE_LOAD</A> or 
<A HREF="globals.html#KDU_CLIENT_FILE_DELETE">KDU_CLIENT_FILE_DELETE</A> flag, that file is also loaded/deleted in the background
via a separate thread, as mentioned above. Note that
any calls to 
<A HREF="kdu_client__reconnect.html">reconnect</A> wait until the background thread completes its work.
</LI><LI>
If 
<A HREF="kdu_client__ope$che_file.html#preamble_only">preamble_only</A> is true, the function reads only the preamble of the
file identified by 
<A HREF="kdu_client__ope$che_file.html#filename">filename</A>. In this case, 
<A HREF="kdu_client__ope$che_file.html#cache_file_handling">cache_file_handling</A> is treated as though it were 0, 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> is treated as though it were NULL, and no background
thread is launched to perform any loading or deletion
of other files. This mode is primarily of interest
when generating thumbnail/summary views of a source
only, since it saves the effort of loading the entire
cache file into memory, when only a small amount of
the content is required to render the summary view.
</LI></UL>
</DIV>

<P ALIGN="CENTER"><HR></P><H2><A NAME="ReturnS">Return Value</A></H2><DIV CLASS="indented-text">
<P>
Like 
<A HREF="kdu_client__connect.html">connect</A>, this function returns a valid queue-id if successful
and this queue-id will inevitably be 0, since that
is always the first created queue. New queues may not
be created using 
<A HREF="kdu_client__add_queue.html">add_queue</A>, since there is actually no connection. However, the
<A HREF="kdu_client__reconnect.html">reconnect</A> function may be used to establish a connection, after
which calls to 
<A HREF="kdu_client__add_queue.html">add_queue</A> should succeed.
</P><P>
 Also, like 
<A HREF="kdu_client__connect.html">connect</A>, if the function does not succeed an error is always
generated through 
<A HREF="kdu_error.html">kdu_error</A>, which usually results in the throwing of an exception
(or else the entire process exists if there is no error
handler that throws exceptions). This means that the
function either returns 0 or does not return at all.
To avoid errors due to non-existence or incompatibility
of the cache file, you are advised to call the static
<A HREF="kdu_client__che$che_file.html">check_cache_file</A> function first.
</P>
</DIV>
<H2><A NAME="ArgS">Arguments</A></H2><DIV CLASS="indented-text">
<H4><A NAME="filename">filename</A> [<B>const char *</B>]</H4><DIV CLASS="indented-text">
<P>
Full or relative path to the file that is to be loaded.
It is recommended that you test the file for existence
and intelligibility using the static 
<A HREF="kdu_client__che$che_file.html">check_cache_file</A> function before calling here.
</P><P>
 The supplied file is treated as read-only and not
directly overwritten with any content that might be
retrieved via a future call to 
<A HREF="kdu_client__reconnect.html">reconnect</A>. However, if you supply a non-NULL 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> argument the contents of the supplied file will be
saved to the 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A>, potentially augmented by content from a connected
server or any pre-existing content read from the 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A>.
</P><P>
 The only condition under which the file supplied via
<A HREF="kdu_client__ope$che_file.html#filename">filename</A> can be modified is if it is already one of the standard
cache files maintained by the client in the directory
identified by a non-NULL 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> argument. These follow a standard naming convention.
</P>
</DIV>
<H4><A NAME="cache_dir">cache_dir</A> [<B>const char *</B>]</H4><DIV CLASS="indented-text">
<P>
As explained, if this argument is non-NULL, it identifies
a directory in which the client is supposed to be managing
cache files associated with its JPIP browsing sessions.
Cache contents may be saved to this directory and existing
files in the directory may augment the information
supplied via the file found at 
<A HREF="kdu_client__ope$che_file.html#filename">filename</A>.
</P><P>
 In the special case where 
<A HREF="kdu_client__ope$che_file.html#filename">filename</A> refers to a file that is actually located within the
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> directory, you are recommended to use full path names
for both 
<A HREF="kdu_client__ope$che_file.html#filename">filename</A> and 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> so that this condition can be recognized. Otherwise,
the the that the files are the same might not be detected
and the content in the cache file might be loaded twice:
the second load may happen in order to augment the
cache representation with content that the function
mistakenly believes may have been obtained from previous
browsing sessions.
</P><P>
 As with 
<A HREF="kdu_client__connect.html">connect</A>, the way in which files in the cache directory are
handled depends upon the 
<A HREF="kdu_client__ope$che_file.html#cache_file_handling">cache_file_handling</A> argument, which will normally be passed with the default
value of 
<B>KDU_CACHE_FILE_LOAD_SAVE</B>, a union of the 
<B>KDU_CACHE_FILE_LOAD</B> and 
<B>KDU_CACHE_FILE_SAVE</B> flags.
</P><P>
 If 
<A HREF="kdu_client__ope$che_file.html#preamble_only">preamble_only</A> is true, the 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> argument is treated as though it were NULL.
</P>
</DIV>
<H4><A NAME="cache_file_handling">cache_file_handling</A> [<B>int</B>]</H4><DIV CLASS="indented-text">
<P>
As for 
<A HREF="kdu_client__connect.html">connect</A>, this argument holds a collection of zero or more
of the following flags, which are meaningful only if
a valid 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> is supplied and 
<A HREF="kdu_client__ope$che_file.html#preamble_only">preamble_only</A> is false.
</P><UL><LI>
<A HREF="globals.html#KDU_CLIENT_FILE_LOAD">KDU_CLIENT_FILE_LOAD</A> means that any compatible existing cache file found
in the 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> will be loaded and used to augment the cache state;
that is, after the 
<A HREF="kdu_client__ope$che_file.html#filename">filename</A> file has been loaded, the function continues to look
for another file (if there is one) that represents
the same content and is found in 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A>, using its contents to augment what was recovered
from the file identified by 
<A HREF="kdu_client__ope$che_file.html#filename">filename</A>.
</LI><LI>
<A HREF="globals.html#KDU_CLIENT_FILE_DELETE">KDU_CLIENT_FILE_DELETE</A> means that a compatible existing cache file is deleted
(after any required loading), if one is found in the
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> directory. Note that the file found within 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> will be deleted EVEN IF it happens to be identical
to that identified by 
<A HREF="kdu_client__ope$che_file.html#filename">filename</A>.
</LI><LI>
<A HREF="globals.html#KDU_CLIENT_FILE_SAVE">KDU_CLIENT_FILE_SAVE</A> means that a cache file is saved to the 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> directory, unless there is no need to do this because
<A HREF="kdu_client__ope$che_file.html#filename">filename</A> refers already to the file that would need to be saved
(saving a copy of the supplied file to itself would
be pointless). Even in this case, the cache will be
saved to 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> if a subsequent call to 
<A HREF="kdu_client__reconnect.html">reconnect</A> collects new data from a server, or a call to 
<A HREF="kdu_client__aug$che_file.html">augment_with_cache_file</A> adds new content from a separate file. The writing
itself does not take place until a client thread is
about to close down (writing then takes place in the
background) or the 
<A HREF="kdu_client__close.html">close</A> function is called (explicitly or implicitly).
</LI></UL>
</DIV>
<H4><A NAME="preamble_only">preamble_only</A> [<B>bool</B>]</H4><DIV CLASS="indented-text">
<P>
If true, the object is being used only to load the
first part of the file identified by 
<A HREF="kdu_client__ope$che_file.html#filename">filename</A> for the purpose of generating a summary view (e.g.,
to build a contact sheet or image-picker). In this
case 
<A HREF="kdu_client__ope$che_file.html#cache_dir">cache_dir</A> is ignored (as if it were NULL) and 
<A HREF="kdu_client__ope$che_file.html#cache_file_handling">cache_file_handling</A> is treated as though it were 0. With this in mind,
we do not recommend that you use this mode if you intend
to issue a call to 
<A HREF="kdu_client__reconnect.html">reconnect</A>.
</P>
</DIV>
</DIV>

<P ALIGN="CENTER"><HR></P><P ALIGN="RIGHT">|<A HREF="#ToP"> top </A>||<A HREF="#SynopsiS"> synopsis </A>||<A HREF="#ReturnS"> return value </A>||<A HREF="#ArgS"> arguments </A>||<A HREF="kdu_client__connect.html"> prev </A>||<A HREF="kdu_client__set$handling.html"> next </A>|</P>
</BODY>
</HTML>
