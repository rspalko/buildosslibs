<HTML>
<HEAD>
<TITLE> Kakadu Hyper-Doc (kdu_codestream::apply_input_restrictions) </TITLE>
<STYLE TYPE="text/css">
<!--
.indented-text { padding-left: 20pt; }
.function-text { padding-left: 80pt;
                 text-indent: -60pt; }
-->
</STYLE>
</HEAD>
<BODY TEXT="#000000" LINK="#0000ff" BGCOLOR="#B4DCB4">
<P ALIGN="RIGHT">|<A HREF="#SynopsiS"> synopsis </A>||<A HREF="#ArgS"> arguments </A>||<A HREF="kdu$tream__set_fast.html"> prev </A>||<A HREF="kdu$tream__app$trictions__2.html"> next </A>|</P>
<H1><A NAME="ToP">kdu_codestream::apply_input_restrictions</A></H1>
<DIR><DIR><H3><EM><U>Java:</U> Kdu_codestream.Apply_input_restrictions</EM></H3></DIR></DIR>
<P>Overload navigation: <B>1,
<A HREF="kdu$tream__app$trictions__2.html">2</A></B></P>
<P CLASS="function-text"><B>void</B> apply_input_restrictions(
<B>int</B>&nbsp;first_component,
<B>int</B>&nbsp;max_components,
<B>int</B>&nbsp;discard_levels,
<B>int</B>&nbsp;max_layers,
const&nbsp;<A HREF ="kdu_dims.html">kdu_dims</A>&nbsp;*&nbsp;region_of_interest,
<B>kdu_component_access_mode</B>&nbsp;access_mode=KDU_WANT_CODESTREAM_COMPONENTS,
<A HREF ="kdu$d_env.html">kdu_thread_env</A>&nbsp;*&nbsp;env=NULL,
const&nbsp;<A HREF ="kdu$miter.html">kdu_quality_limiter</A>&nbsp;*&nbsp;limiter=NULL)</P>
<DIR><DIR><P CLASS="function-text"><EM><U>Java:</U> public native void Apply_input_restrictions(
int&nbsp;first_component,
int&nbsp;max_components,
int&nbsp;discard_levels,
int&nbsp;max_layers,
Kdu_dims&nbsp;region_of_interest,
int&nbsp;access_mode,
Kdu_thread_env&nbsp;env,
Kdu_quality_limiter&nbsp;limiter)</EM></P></DIR></DIR>
<P><A HREF="kdu$tream.html">Go to class description.</A></P>

<P ALIGN="CENTER"><HR></P><H2><A NAME="SynopsiS">Synopsis</A></H2>
<DIV CLASS="indented-text">
<P>
This function may be used only with 
<B>input codestreams</B> (i.e., 
<A HREF="kdu$tream.html">kdu_codestream</A> created for reading from a compressed data source)
or 
<B>interchange codestreams</B> (
<A HREF="kdu$tream.html">kdu_codestream</A> created without either a compressed source or a compressed
target). It restricts the elements of the compressed
image representation which will appear to be present.
Since the function has an impact on the dimensions
returned by other member functions, these dimensions
may need to be re-acquired afterwards. The role of
this function is closely related to that of the 
<A HREF="kdu$tream__cha$ppearance.html">change_appearance</A> member function; however, the latter function may
be applied to 
<B>output codestreams</B> as well.
</P><P>
 The function may be invoked multiple times to alter
the region of interest, resolution, image components,
number of quality layers visible to the user, or to
apply additional quality limitations to the content
so as to optimize throughput for particular applications.
However, after the first tile is opened, the function
may be applied only to interchange codestreams or input
codestreams which are set up in the persistent mode
(see 
<A HREF="kdu$tream__set$ersistent.html">set_persistent</A>). This is because non-persistent input codestreams
discard compressed data and all associated structural
elements (tiles, subbands, etc.) once we know that
they will no longer be used &mdash; this information
is based on the input restrictions themselves.
</P><P>
 Even in the persistent case, you may not call this
function while any tile is open. Moreover, to ensure
that there are no tiles that are awaiting closure by
a background processing thread (see 
<A HREF="kdu_tile__close.html">kdu_tile::close</A>), in multi-threaded applications, you must either
provide a non-NULL 
<A HREF="kdu$tream__app$trictions__1.html#env">env</A> argument to this function or else you must ensure
that 
<A HREF="kdu$d_env__cs_terminate.html">kdu_thread_env::cs_terminate</A> has been called before invoking the present function,
unless you have not yet passed a 
<A HREF="kdu$d_env.html">kdu_thread_env</A> pointer to any of the current codestream's interface
functions since it was created or since 
<A HREF="kdu$d_env__cs_terminate.html">kdu_thread_env::cs_terminate</A> was last called, or you have not scheduled any tiles
for background closure processing since the last such
event.
</P><P>
 Calls to 
<A HREF="kdu$tream__restart__1.html">restart</A> after 
<A HREF="kdu$tream__app$trictions__1.html">apply_input_restrictions</A> may not preserve restrictions correctly, so if you
are using both 
<A HREF="kdu$tream__restart__1.html">restart</A> and 
<A HREF="kdu$tream__app$trictions__1.html">apply_input_restrictions</A>, you should be sure to re-apply the required restrictions
after a 
<A HREF="kdu$tream__restart__1.html">restart</A>.
</P><P>
 Zero valued arguments are always interpreted as meaning
that any restrictions should be removed from the relevant
attributes.
</P><P>
 There are two forms to the overloaded 
<A HREF="kdu$tream__app$trictions__1.html">apply_input_restrictions</A> function. The second form provides significantly more
flexibility in specifying the collection of image components
which are of interest. For both forms of the function,
however, it is possible to identify whether the image
components which are of interest belong to the class
known as "output image components" or the class known
as "codestream image components". This is determined
by the 
<A HREF="kdu$tream__app$trictions__1.html#access_mode">access_mode</A> argument which takes one of the following two values:
</P><UL><LI>
<A HREF="globals.html#KDU_WANT_CODESTREAM_COMPONENTS">KDU_WANT_CODESTREAM_COMPONENTS</A> &mdash; If this access mode is selected, the collection
of visible codestream image components is determined
by the 
<A HREF="kdu$tream__app$trictions__1.html#first_component">first_component</A> and 
<A HREF="kdu$tream__app$trictions__1.html#max_components">max_components</A> arguments (if 0, no restrictions apply). In this case,
however, the codestream image components will be treated
as though they are also output image components, in
calls to functions such as 
<A HREF="kdu$tream__get_dims.html">get_dims</A>, 
<A HREF="kdu$tream__get$bsampling.html">get_subsampling</A> and so forth; information about any multi-component
transforms will be entirely concealed. This mode is
consistent with the services offered by Kakadu in versions
prior to v5.0, but not useful for more general applications
which may need to correctly handle Part-2 multi-component
transforms and/or Part-2 non-linear point transforms.
It is set as the default value for the 
<A HREF="kdu$tream__app$trictions__1.html#access_mode">access_mode</A> argument to this function so as to ensure backward
compatibility, but the function may be changed in the
future to remove any default from 
<A HREF="kdu$tream__app$trictions__1.html#access_mode">access_mode</A> so as to make the behaviour more explicit and potentially
avoid programming pitfalls.
</LI><LI>
<A HREF="globals.html#KDU_WANT_OUTPUT_COMPONENTS">KDU_WANT_OUTPUT_COMPONENTS</A> &mdash; If this access mode is selected, the 
<A HREF="kdu$tream__app$trictions__1.html#first_component">first_component</A> and 
<A HREF="kdu$tream__app$trictions__1.html#max_components">max_components</A> arguments serve (if non-zero) to restrict the collection
of output components, as found after the application
of any colour transform or inverse multi-component
transform. In this case, all original codestream components
will be visible, in the sense that calls to functions
such as 
<A HREF="kdu$tream__get_dims.html">get_dims</A>, 
<A HREF="kdu$tream__get$bit_depth.html">get_bit_depth</A>, 
<A HREF="kdu$tream__get_signed.html">get_signed</A> and so forth return information for all original codestream
components. Also, if these component information functions
are accessed with the optional 
<B>want_output_comps</B> argument set to true, they will return information
associated with the (possibly restricted and/or permuted)
output image components. Even though all original codestream
image components are visible, the 
<A HREF="kdu_tile__acc$_component.html">kdu_tile::access_component</A> function will return an empty interface if you attempt
to access any tile-component which is not actually
involved in the reconstruction of any visible output
image component within that tile. These components
are discarded immediately during codestream parsing,
if the non-persistent input mode is being used (see
<A HREF="kdu$tream__set$ersistent.html">set_persistent</A>). As mentioned above, it can happen that some tile-components
are not used in the reconstruction of any output image
component at all, regardless of whether restrictions
are imposed. These tile-components will never be accessible
in the 
<A HREF="globals.html#KDU_WANT_OUTPUT_COMPONENTS">KDU_WANT_OUTPUT_COMPONENTS</A> mode. If there is no Part-2 multi-component transform
(MCT), there is a 1-1 correspondence between output
image components and codestream image components, except
possibly where the Part-1 reversible or irreversible
colour transform (RCT or ICT) is used (this may vary
from tile to tile), in which case the first three codestream
image components will always be accessible, if any
of the first three output components is made visible.
If there are any Part-2 non-linear point transforms
(NLT), the bit-depth (precision) and signed/unsigned
characteristics of the output components may be different
from that of the codestream components even if there
is no MCT, but non-linear point transforms do not have
any impact on the number of output components or their
dependencies.
</LI></UL>
</DIV>

<P ALIGN="CENTER"><HR></P><H2><A NAME="ArgS">Arguments</A></H2><DIV CLASS="indented-text">
<H4><A NAME="first_component">first_component</A> [<B>int</B>]</H4><DIV CLASS="indented-text">
<P>
Identifies the index (starting from 0) of the first
component to be presented to the user. If 
<A HREF="kdu$tream__app$trictions__1.html#access_mode">access_mode</A> is equal to 
<A HREF="globals.html#KDU_WANT_CODESTREAM_COMPONENTS">KDU_WANT_CODESTREAM_COMPONENTS</A>, this is the first apparent codestream component and
it will also appear to be the first apparent output
component, since output and codestream components become
equivalent in this mode. If 
<A HREF="kdu$tream__app$trictions__1.html#access_mode">access_mode</A> is equal to 
<A HREF="globals.html#KDU_WANT_OUTPUT_COMPONENTS">KDU_WANT_OUTPUT_COMPONENTS</A>, this is the first apparent output component, while
all codestream components will be apparent.
</P>
</DIV>
<H4><A NAME="max_components">max_components</A> [<B>int</B>]</H4><DIV CLASS="indented-text">
<P>
Identifies the maximum number of image components which
will appear to be present, starting from the component
identified by the 
<A HREF="kdu$tream__app$trictions__1.html#first_component">first_component</A> argument. If 
<A HREF="kdu$tream__app$trictions__1.html#max_components">max_components</A> is 0, all remaining components will appear. As with
<A HREF="kdu$tream__app$trictions__1.html#first_component">first_component</A>, the interpretation of the components which are being
restricted depends upon the 
<A HREF="kdu$tream__app$trictions__1.html#access_mode">access_mode</A> argument.
</P>
</DIV>
<H4><A NAME="discard_levels">discard_levels</A> [<B>int</B>]</H4><DIV CLASS="indented-text">
<P>
Indicates the number of highest resolution levels which
will not appear to the user. Image dimensions are essentially
divided by 2 to the power of this number. This argument
affects the apparent dimensions and number of DWT levels
in each tile-component. Note, however, that neither
this nor any other argument has any effect on the parameter
sub-system, as accessed through the 
<A HREF="kdu_params.html">kdu_params</A> object (actually the head of a multi-dimensional list
of parameter objects) returned by the 
<A HREF="kdu$tream__access_siz.html">access_siz</A> function.
</P><P>
 If 
<A HREF="kdu$tream__app$trictions__1.html#discard_levels">discard_levels</A> exceeds the number of DWT levels in some tile-component,
it will still be possible to open the relevant tile
successfully; however, any attempt to access the problem
tile-component's resolutions (
<A HREF="kdu$_comp__acc$esolution__1.html">kdu_tile_comp::access_resolution</A>) will cause an error message to be generated through
<A HREF="kdu_error.html">kdu_error</A>. The minimum number of DWT levels across all tile-components
is incrementally determined as tiles are opened; the
current value is reported via the 
<A HREF="kdu$tream__get$wt_levels.html">get_min_dwt_levels</A> function.
</P>
</DIV>
<H4><A NAME="max_layers">max_layers</A> [<B>int</B>]</H4><DIV CLASS="indented-text">
<P>
Identifies the maximum number of quality layers which
will appear to be present when precincts or code-blocks
are accessed. A value of 0 has the interpretation that
all layers are of interest, although content may nonetheless
be truncated if a 
<A HREF="kdu$tream__app$trictions__1.html#limiter">limiter</A> is supplied.
</P>
</DIV>
<H4><A NAME="region_of_interest">region_of_interest</A> [const&nbsp;<A HREF ="kdu_dims.html">kdu_dims</A>&nbsp;*]</H4><DIV CLASS="indented-text">
<P>
If NULL, any region restrictions are removed. Otherwise,
provides a region of interest on the high resolution
grid. Any attempt to access tiles or other subordinate
partitions which do not intersect with this region
will result in an error being generated through 
<A HREF="kdu_error.html">kdu_error</A>. Note that the region may be larger than the actual
image region. Also, the region must be described in
terms of the original code-stream geometry. Specifically
any appearance transformations supplied by the 
<A HREF="kdu$tream__cha$ppearance.html">change_appearance</A> member function have no impact on the interpretation
of the region. You may find the 
<A HREF="kdu$tream__map_region.html">map_region</A> member function useful in creating suitable regions.
</P>
</DIV>
<H4><A NAME="access_mode">access_mode</A> [<B>kdu_component_access_mode</B>]</H4><DIV CLASS="indented-text">
<P>
Takes one of the values 
<A HREF="globals.html#KDU_WANT_CODESTREAM_COMPONENTS">KDU_WANT_CODESTREAM_COMPONENTS</A> or 
<A HREF="globals.html#KDU_WANT_OUTPUT_COMPONENTS">KDU_WANT_OUTPUT_COMPONENTS</A>, as explained above.
</P>
</DIV>
<H4><A NAME="env">env</A> [<A HREF ="kdu$d_env.html">kdu_thread_env</A>&nbsp;*]</H4><DIV CLASS="indented-text">
<P>
From KDU-7.4, this argument is provided to ensure robust
multi-threaded processing. This is important because
tiles might have been scheduled for closure in a background
processing job via 
<A HREF="kdu_tile__close.html">kdu_tile::close</A>, and the codestream configuration should not be changed
while this is going on. You can pass NULL for this
argument if you have not yet used this 
<A HREF="kdu$tream.html">kdu_codestream</A> object with a multi-threaded processing environment,
or you have called 
<A HREF="kdu$d_env__cs_terminate.html">kdu_thread_env::cs_terminate</A> since you last did so, or if there are no tiles that
have been scheduled for background closure processing
since the codestream was created or it was last passed
to 
<A HREF="kdu$d_env__cs_terminate.html">kdu_thread_env::cs_terminate</A>. Otherwise, an appropriate error will be generated
through 
<A HREF="kdu_error.html">kdu_error</A>.
</P>
</DIV>
<H4><A NAME="limiter">limiter</A> [const&nbsp;<A HREF ="kdu$miter.html">kdu_quality_limiter</A>&nbsp;*]</H4><DIV CLASS="indented-text">
<P>
Providing a non-NULL 
<A HREF="kdu$tream__app$trictions__1.html#limiter">limiter</A> argument has an effect which is related to 
<A HREF="kdu$tream__app$trictions__1.html#max_layers">max_layers</A>, but does not require the existence of multiple quality
layers or any knowledge of their interpretation. The
<A HREF="kdu$tream__app$trictions__1.html#limiter">limiter</A> object is constructed with a 
<B>weighted_rmse</B> parameter that represents the square roote of a weighted
mean squared error (normalized) that can be tolerated
in the reconstruction. Depending on the value of this
parameter, and any additional component and/or visual
weights that are supplied also by the 
<A HREF="kdu$tream__app$trictions__1.html#limiter">limiter</A> object, number number of coding passes (and associated
code-bytes) retrieved by calls to 
<A HREF="kdu$bband__open_block.html">kdu_subband::open_block</A> may be reduced, so long as it seems that this reduction
will not violate the weighted_rmse target.
</P><P>
 The actual behaviour of the 
<A HREF="kdu$tream__app$trictions__1.html#limiter">limiter</A> object is described carefully in the comments that
accompany the 
<A HREF="kdu$miter.html">kdu_quality_limiter</A> constructor. Here, we only mention a few key points:
</P><UL><LI>
Use of a 
<A HREF="kdu$tream__app$trictions__1.html#limiter">limiter</A> can be especially beneficial when 
<A HREF="kdu$tream__app$trictions__1.html#discard_levels">discard_levels</A> is non-zero. The reason for this is that R-D optimally
compressed images have subbands whose precision increases
progressively as we go deeper into the DWT hierarchy.
The optimal number of bits to assign a given subband
(for a given quality level) depends strongly on how
many DWT levels lie above it in the synthesis hierarchy.
When reconstructing a high resolution at reduced resolution,
all subbands tend to have unnecessarily high precision,
so that significant computational effort is wasted
on decoding &mdash; in fact, since the computational
load imposed by a JPEG2000 decoder are strongly dependent
on bit-rate, reconstructing a much reduced resolution
version of an image or video can potentially be several
times more demanding than reconstructing a version
of the content that was compressed directly at the
reduced resolution. The 
<A HREF="kdu$tream__app$trictions__1.html#limiter">limiter</A> largely solves such problems, representing a means
to obtain complexity-scalability from the JPEG2000
structure.
</LI><LI>
The weighted mean squared error identified by a 
<A HREF="kdu$tream__app$trictions__1.html#limiter">limiter</A> is an average over all samples of all output image
components, after applying any component restrictions
and discarding any resolution levels, in accordance
with the other parameters to this function.
</LI><LI>
The 
<A HREF="kdu$tream__app$trictions__1.html#limiter">limiter</A> can, optionally, be configured to apply "visual" weights
in assessing the distortion target, where these weights
are derived from display resolution numbers (with a
well-defined assumed viewing distance). This can be
very beneficial in avoiding the decoding of unnecessary
content, especially when targeting retina displays.
You should bear in mind that all resolution properties
are expressed with respect to a (potentially hypothetical)
image component that has no componnt sub-sampling (i.e.,
subsampling factors of 1), after discarding resolution
levels according to the 
<A HREF="kdu$tream__app$trictions__1.html#discard_levels">discard_levels</A> argument to this function.
</LI><LI>
The 
<A HREF="kdu$tream__app$trictions__1.html#limiter">limiter</A> object uses a rate-disotortion optimization principle
to determine a sufficiently small quantization step
size for each subband, such that the weighted distortion
target will be achieved; code-blocks are truncated
in a reasonably conservative manner so that the target
is unlikely to be violated &mdash; but accurate achievement
of the target is not the objective.
</LI><LI>
The 
<A HREF="kdu$tream__app$trictions__1.html#limiter">limiter</A> is configured, by default, not to apply any truncation
to content that has been reversibly compressed, if
<A HREF="kdu$tream__app$trictions__1.html#discard_levels">discard_levels</A> is 0, sine this may prevent losslessly compressed
from being decoded completely losslesly and may have
adverse consequences such as medical liability. However,
this attribute is readily overridden.
</LI></UL><P>
 Each time you call 
<B>apply_input_constraints</B>, any quality limitation that was previously applied
is removed &mdash; of course, this only affects persistent
codestreams (see 
<A HREF="kdu$tream__set$ersistent.html">set_persistent</A>).
</P><P>
 The behaviour of a 
<A HREF="kdu$tream__app$trictions__1.html#limiter">limiter</A> is defined with respect to output image components;
constraints on the output component, along with any
configured weights, are mapped to codestream components
and hence to subbands within this function. However,
if 
<A HREF="kdu$tream__app$trictions__1.html#access_mode">access_mode</A> is equal to 
<A HREF="globals.html#KDU_WANT_CODESTREAM_COMPONENTS">KDU_WANT_CODESTREAM_COMPONENTS</A>, the output components become the codestream components
(i.e., the codestream appears to have no multi-component
transform).
</P><P>
 The object you pass via this argument is actually
copied internally, using 
<A HREF="kdu$miter__duplicate.html">limiter&rarr;duplicate</A>, since some of its effects cannot be applied until
tiles are opened. Since the object is copied, you can
feel free to re-use or destroy the 
<A HREF="kdu$tream__app$trictions__1.html#limiter">limiter</A> immediately.
</P>
</DIV>
</DIV>

<P ALIGN="CENTER"><HR></P><P ALIGN="RIGHT">|<A HREF="#ToP"> top </A>||<A HREF="#SynopsiS"> synopsis </A>||<A HREF="#ArgS"> arguments </A>||<A HREF="kdu$tream__set_fast.html"> prev </A>||<A HREF="kdu$tream__app$trictions__2.html"> next </A>|</P>
</BODY>
</HTML>
